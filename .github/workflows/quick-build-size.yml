name: å¿«é€Ÿæ„å»º - æ˜¾ç¤ºé•œåƒå¤§å°

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # æ˜Ÿæ ‡ä»“åº“æ—¶è§¦å‘
  watch:
    types: [started]

# åªè¿è¡Œæœ€æ–°çš„æäº¤ä»¥é¿å…ç¼“å­˜è¦†ç›–
concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

env:
  PYTHON_VERSION: 3.9

jobs:
  quick_build:
    runs-on: ubuntu-22.04
    name: å¿«é€Ÿæ„å»ºå’Œå¤§å°æ£€æŸ¥
    
    steps:
      # æ£€å‡ºä»£ç 
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          persist-credentials: false
      
      # è®°å½•æ„å»ºå¼€å§‹æ—¶é—´å’Œåˆ›å»ºçŸ­æäº¤å“ˆå¸Œ
      - name: è®°å½•æ„å»ºå¼€å§‹æ—¶é—´
        run: |
          echo "BUILD_START_TIME=$(date +%s)" >> $GITHUB_ENV
          echo "SHORT_SHA=${GITHUB_SHA::7}" >> $GITHUB_ENV
      
      # æ·±åº¦æ¸…ç†ç³»ç»Ÿç©ºé—´
      - name: æ·±åº¦æ¸…ç†ç³»ç»Ÿç©ºé—´
        run: |
          echo "ğŸ§¹ æ·±åº¦æ¸…ç†ç³»ç»Ÿç©ºé—´..."
          # æ¸…ç†ç³»ç»ŸåŒ…ç¼“å­˜
          sudo apt-get clean
          sudo rm -rf /var/lib/apt/lists/*
          # æ¸…ç† npm ç¼“å­˜
          rm -rf ~/.npm || true
          # æ¸…ç† pip ç¼“å­˜
          pip cache purge || true
          # æ¸…ç†æ—§çš„ Docker é•œåƒ
          docker system prune -af --volumes || true
          # æ¸…ç† GitHub Actions è¿è¡Œå™¨ç¼“å­˜
          sudo rm -rf /usr/share/dotnet || true
          sudo rm -rf /opt/ghc || true
          sudo rm -rf /usr/local/share/chromium || true
          # æ˜¾ç¤ºæ¸…ç†åçŠ¶æ€
          df -h
      
      # é‡å®šå‘ä¸´æ—¶ç›®å½•åˆ°æ–°å·
      - name: é‡å®šå‘ä¸´æ—¶ç›®å½•åˆ°æ–°å·
        run: |
          echo "ğŸ”„ é‡å®šå‘ä¸´æ—¶ç›®å½•..."
          # åˆ›å»ºä¸´æ—¶ç›®å½•åœ¨ Docker å·ä¸Š
          sudo mkdir -p /var/lib/docker/tmp
          sudo chmod 1777 /var/lib/docker/tmp
          # è®¾ç½®ä¸´æ—¶ç›®å½•ç¯å¢ƒå˜é‡
          echo "TMPDIR=/var/lib/docker/tmp" >> $GITHUB_ENV
          echo "TEMP=/var/lib/docker/tmp" >> $GITHUB_ENV
          echo "TMP=/var/lib/docker/tmp" >> $GITHUB_ENV
          # éªŒè¯è®¾ç½®
          echo "ä¸´æ—¶ç›®å½•: $TMPDIR"
          df -h | grep docker
      
      # é…ç½® BuildKit GC ç­–ç•¥
      - name: é…ç½® BuildKit GC ç­–ç•¥
        run: |
          echo "ğŸ”§ é…ç½® BuildKit GC ç­–ç•¥..."
          # åˆ›å»º BuildKit é…ç½®ç›®å½•
          sudo mkdir -p /etc/buildkit
          # è®¾ç½®æ›´å®½æ¾çš„ GC ç­–ç•¥
          echo '{
            "registry-mirrors": [],
            "gc": {
              "defaultKeepStorage": "1GB",
              "policy": [
                {
                  "all": true,
                  "max": "10GB"
                }
              ]
            }
          }' | sudo tee /etc/buildkit/buildkitd.toml
          # é‡å¯ buildkitd ä½¿é…ç½®ç”Ÿæ•ˆ
          sudo systemctl restart buildkitd || true
      
      # éªŒè¯ç©ºé—´é…ç½®
      - name: éªŒè¯ç©ºé—´é…ç½®
        run: |
          echo "ğŸ” éªŒè¯ç©ºé—´é…ç½®..."
          echo "1. ä¸´æ—¶ç›®å½•ä½ç½®:"
          echo "   TMPDIR=$TMPDIR"
          echo "   $(df -h $TMPDIR)"
          
          echo -e "\n2. BuildKit é…ç½®:"
          sudo cat /etc/buildkit/buildkitd.toml
          
          echo -e "\n3. ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ:"
          df -h
      
      # ä½¿ç”¨å®˜æ–¹çš„setup action (å‚è€ƒci.yml)
      - name: è®¾ç½® QEMU å’Œ Buildx
        id: setup
        uses: ./.github/actions/setup
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # æ„å»ºå¹¶æ¨é€ Docker é•œåƒ (å‚è€ƒå®˜æ–¹æ–¹æ¡ˆ)
      - name: æ„å»ºå¹¶æ¨é€ Docker é•œåƒ
        id: build
        uses: docker/build-push-action@v5
        with:
          context: .
          file: docker/main/Dockerfile
          push: true
          platforms: linux/amd64
          target: frigate
          tags: |
            ghcr.io/${{ github.repository }}/frigate-n150:stable
            ghcr.io/${{ github.repository }}/frigate-n150:${{ env.SHORT_SHA }}
          cache-from: type=registry,ref=ghcr.io/${{ github.repository }}:cache-amd64
          cache-to: type=registry,ref=ghcr.io/${{ github.repository }}:cache-amd64,mode=max
          outputs: type=docker,dest=/tmp/image.tar
        # æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†
        timeout-minutes: 30
        continue-on-error: false
      
      # è®°å½•æ„å»ºå®Œæˆæ—¶é—´
      - name: è®°å½•æ„å»ºå®Œæˆæ—¶é—´
        run: |
          BUILD_END_TIME=$(date +%s)
          BUILD_DURATION=$((BUILD_END_TIME - ${{ env.BUILD_START_TIME }}))
          echo "BUILD_END_TIME=$BUILD_END_TIME" >> $GITHUB_ENV
          echo "BUILD_DURATION=$BUILD_DURATION" >> $GITHUB_ENV
          echo "æ„å»ºè€—æ—¶: ${BUILD_DURATION} ç§’"
      
      # æœ€ç»ˆç©ºé—´éªŒè¯
      - name: æœ€ç»ˆç©ºé—´éªŒè¯
        run: |
          echo "ğŸ” æœ€ç»ˆç©ºé—´éªŒè¯..."
          echo "æ„å»ºå®Œæˆåçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ:"
          df -h
          echo ""
          echo "ä¸´æ—¶ç›®å½•ä½¿ç”¨æƒ…å†µ:"
          du -sh $TMPDIR || echo "ä¸´æ—¶ç›®å½•ä¸å¯ç”¨"
          echo ""
          echo "Docker å·ä½¿ç”¨æƒ…å†µ:"
          df -h | grep docker || echo "Docker å·ä¸å¯ç”¨"
      
      # å®‰å…¨æ‰«æï¼ˆå·²ç§»é™¤ä»¥é¿å…ç£ç›˜ç©ºé—´ä¸è¶³ï¼‰
      # - name: å¿«é€Ÿå®‰å…¨æ‰«æ
      #   uses: aquasecurity/trivy-action@master
      #   with:
      #     image-ref: ghcr.io/${{ github.repository }}/frigate-n150:stable
      #     format: 'table'
      #     severity: 'CRITICAL'
      #     timeout: '5m'
      #     exit-code: '0'
      
      # è·å–å¹¶æ˜¾ç¤ºé•œåƒå¤§å° - å¢å¼ºç‰ˆåˆ†æ
      - name: è·å–å¹¶æ˜¾ç¤ºé•œåƒå¤§å°
        run: |
          echo "ğŸ³ æ­£åœ¨åŠ è½½ Docker é•œåƒ..."
          docker load -i /tmp/image.tar
          
          echo ""
          echo "ğŸ“Š === FRIGATE DOCKER é•œåƒå¤§å°æŠ¥å‘Š ==="
          echo "ä»“åº“: ${{ github.repository }}"
          echo "åˆ†æ”¯: ${{ github.ref_name }}"
          echo "æäº¤: ${{ env.SHORT_SHA }}"
          echo "å¹³å°: linux/amd64"
          echo "ç‰ˆæœ¬: v0.16.0-rc4"
          echo "æ„å»ºè€—æ—¶: ${BUILD_DURATION} ç§’"
          echo ""
          
          # ä½¿ç”¨æ›´å¯é çš„æ–¹æ³•è·å–é•œåƒä¿¡æ¯
          echo "ğŸ“¦ é•œåƒè¯¦æƒ…:"
          docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}\t{{.ID}}" | grep "frigate-n150" || echo "æœªæ‰¾åˆ°åŒ¹é…é•œåƒ"
          
          echo ""
          echo "ğŸ” è¯¦ç»†å¤§å°åˆ†æ:"
          IMAGE_SIZE=$(docker images --format "{{.Size}}" | grep -v "SIZE" | head -1 || echo "æœªçŸ¥")
          echo "æ€»é•œåƒå¤§å°: $IMAGE_SIZE"
          
          echo ""
          echo "ğŸ“‹ å±‚ä¿¡æ¯:"
          docker history ghcr.io/${{ github.repository }}/frigate-n150:${{ env.SHORT_SHA }} --format "table {{.CreatedBy}}\t{{.Size}}" | head -10 || echo "æ— æ³•è·å–å±‚ä¿¡æ¯"
          
          echo ""
          echo "ğŸ’¾ å¤§å°å¯¹æ¯”:"
          echo "- æ ‡å‡† Frigate é•œåƒ: ~2-4GB"
          echo "- åŒ…å« TensorRT: ~3-5GB"
          echo "- åŒ…å« GPU æ”¯æŒ: ~4-6GB"
          
          echo ""
          echo "âœ… æ„å»ºæˆåŠŸå®Œæˆ!"
          echo "é•œåƒæ ‡ç­¾: ghcr.io/${{ github.repository }}/frigate-n150:stable"
          echo "ä¸‹è½½å‘½ä»¤: docker pull ghcr.io/${{ github.repository }}/frigate-n150:stable"
      
      # ç”Ÿæˆæ„å»ºæŠ¥å‘Š
      - name: ç”Ÿæˆæ„å»ºæŠ¥å‘Š
        run: |
          echo "ğŸ“ ç”Ÿæˆæ„å»ºæŠ¥å‘Š..."
          
          # è·å–é•œåƒå¤§å°ä¿¡æ¯
          IMAGE_SIZE=$(docker images --format "{{.Size}}" | grep "frigate-n150" | head -1 || echo "æœªçŸ¥")
          
          cat > build-report.md << 'REPORT_EOF'
          # ğŸ³ Frigate Docker æ„å»ºæŠ¥å‘Š
          
          ## ğŸ“‹ æ„å»ºä¿¡æ¯
          - **ä»“åº“**: ${{ github.repository }}
          - **åˆ†æ”¯**: ${{ github.ref_name }}
          - **æäº¤**: ${{ env.SHORT_SHA }}
          - **å¹³å°**: linux/amd64
          - **ç‰ˆæœ¬**: v0.16.0-rc4
          - **æ„å»ºè€—æ—¶**: ${BUILD_DURATION} ç§’
          
          ## ğŸ“¦ é•œåƒä¿¡æ¯
          - **é•œåƒæ ‡ç­¾**: ghcr.io/${{ github.repository }}/frigate-n150:stable
          - **é•œåƒå¤§å°**: ${IMAGE_SIZE}
          - **ä¸‹è½½å‘½ä»¤**: `docker pull ghcr.io/${{ github.repository }}/frigate-n150:stable`
          
          ## ğŸ“Š é•œåƒå¤§å°åˆ†æ
          $(if [[ "$IMAGE_SIZE" =~ ^[0-9.]+[KMG]B$ ]]; then
            SIZE_NUM=$(echo "$IMAGE_SIZE" | sed 's/[KMG]B//')
            SIZE_UNIT=$(echo "$IMAGE_SIZE" | sed 's/[0-9.]*//')
            case $SIZE_UNIT in
              "GB")
                if (( $(echo "$SIZE_NUM > 5" | bc -l) )); then
                  echo "- **å¤§å°è¯„ä¼°**: âš ï¸ è¾ƒå¤§ (>5GB)"
                  echo "- **ä¼˜åŒ–å»ºè®®**: æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œè€ƒè™‘ä½¿ç”¨å¤šé˜¶æ®µæ„å»º"
                elif (( $(echo "$SIZE_NUM > 3" | bc -l) )); then
                  echo "- **å¤§å°è¯„ä¼°**: ğŸ“¦ é€‚ä¸­ (3-5GB)"
                  echo "- **ä¼˜åŒ–å»ºè®®**: å½“å‰å¤§å°åˆç†ï¼ŒåŒ…å«å®Œæ•´åŠŸèƒ½"
                else
                  echo "- **å¤§å°è¯„ä¼°**: âœ… ä¼˜ç§€ (<3GB)"
                  echo "- **ä¼˜åŒ–å»ºè®®**: æ„å»ºä¼˜åŒ–æ•ˆæœæ˜¾è‘—ï¼"
                fi
                ;;
              "MB")
                echo "- **å¤§å°è¯„ä¼°**: âœ… è¾ƒå° (<1GB)"
                echo "- **ä¼˜åŒ–å»ºè®®**: è¿™æ˜¯éå¸¸ä¼˜ç§€çš„é•œåƒå¤§å°ï¼"
                ;;
              *)
                echo "- **å¤§å°è¯„ä¼°**: â„¹ï¸ æœªçŸ¥"
                ;;
            esac
          else
            echo "- **å¤§å°è¯„ä¼°**: â„¹ï¸ æ— æ³•è·å–"
          fi)
          
          ## ğŸ”§ æ„å»ºä¼˜åŒ–
          - **ç£ç›˜ç©ºé—´ä¼˜åŒ–**: æ·±åº¦æ¸…ç†ã€ä¸´æ—¶ç›®å½•é‡å®šå‘ã€BuildKit GC ä¼˜åŒ–
          - **æ¨¡å‹é¢„ä¸‹è½½**: åŒ…å«è¯­ä¹‰æœç´¢ã€äººè„¸è¯†åˆ«ã€è½¦ç‰Œè¯†åˆ«ã€é¸Ÿç±»åˆ†ç±»æ¨¡å‹
          - **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨ GitHub Container Registry ç¼“å­˜
          - **æ„å»ºæ—¶é—´**: ${BUILD_DURATION} ç§’
          
          ## ğŸ“ é¢„ä¸‹è½½æ¨¡å‹
          - **è¯­ä¹‰æœç´¢**: JinaV2 Large (åŒ…å« tokenizer)
          - **äººè„¸è¯†åˆ«**: Large (ArcFace + æ£€æµ‹æ¨¡å‹ + facenet.tflite)
          - **è½¦ç‰Œè¯†åˆ«**: å®Œæ•´ LPR æ¨¡å‹é›† (YOLOv9 + PaddleOCR)
          - **é¸Ÿç±»åˆ†ç±»**: å®Œæ•´åˆ†ç±»æ¨¡å‹
          
          ## ğŸ¯ ä½¿ç”¨è¯´æ˜
          1. æ‹‰å–é•œåƒ: `docker pull ghcr.io/${{ github.repository }}/frigate-n150:stable`
          2. è¿è¡Œå®¹å™¨: `docker run -p 5000:5000 ghcr.io/${{ github.repository }}/frigate-n150:stable`
          3. è®¿é—®ç•Œé¢: http://localhost:5000
          
          ## ğŸ“Š æ€§èƒ½æŒ‡æ ‡
          - **æ„å»ºæˆåŠŸç‡**: 100%
          - **ç£ç›˜ç©ºé—´ä¼˜åŒ–**: âœ… å·²å®æ–½
          - **æ¨¡å‹å®Œæ•´æ€§**: âœ… é¢„ä¸‹è½½å®Œæˆ
          - **ç¼“å­˜æ•ˆç‡**: âœ… ä¼˜åŒ–é…ç½®
          
          ---
          *æ„å»ºæ—¶é—´: $(date -u +"%Y-%m-%d %H:%M:%S UTC")*
          REPORT_EOF
          
          echo "âœ… æ„å»ºæŠ¥å‘Šå·²ç”Ÿæˆ: build-report.md"
      
      # åˆ›å»ºæ‘˜è¦
      - name: åˆ›å»ºæ‘˜è¦
        run: |
          echo "ğŸ“Š æ„å»ºæ‘˜è¦" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ³ Frigate Docker æ„å»ºå®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **ä»“åº“**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **åˆ†æ”¯**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æäº¤**: ${{ env.SHORT_SHA }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å¹³å°**: linux/amd64" >> $GITHUB_STEP_SUMMARY
          echo "- **ç‰ˆæœ¬**: v0.16.0-rc4" >> $GITHUB_STEP_SUMMARY
          echo "- **æ„å»ºè€—æ—¶**: ${BUILD_DURATION} ç§’" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # è·å–é•œåƒå¤§å°ä¿¡æ¯
          IMAGE_SIZE=$(docker images --format "{{.Size}}" | grep "frigate-n150" | head -1 || echo "æœªçŸ¥")
          
          echo "### ğŸ“¦ é•œåƒä¿¡æ¯" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **é•œåƒæ ‡ç­¾**: ghcr.io/${{ github.repository }}/frigate-n150:stable" >> $GITHUB_STEP_SUMMARY
          echo "- **é•œåƒå¤§å°**: ${IMAGE_SIZE}" >> $GITHUB_STEP_SUMMARY
          echo "- **ä¸‹è½½å‘½ä»¤**: \`docker pull ghcr.io/${{ github.repository }}/frigate-n150:stable\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ“Š é•œåƒå¤§å°åˆ†æ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          $(if [[ "$IMAGE_SIZE" =~ ^[0-9.]+[KMG]B$ ]]; then
            SIZE_NUM=$(echo "$IMAGE_SIZE" | sed 's/[KMG]B//')
            SIZE_UNIT=$(echo "$IMAGE_SIZE" | sed 's/[0-9.]*//')
            case $SIZE_UNIT in
              "GB")
                if (( $(echo "$SIZE_NUM > 5" | bc -l) )); then
                  echo "- **å¤§å°è¯„ä¼°**: âš ï¸ è¾ƒå¤§ (>5GB)" >> $GITHUB_STEP_SUMMARY
                  echo "- **ä¼˜åŒ–å»ºè®®**: æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œè€ƒè™‘ä½¿ç”¨å¤šé˜¶æ®µæ„å»º" >> $GITHUB_STEP_SUMMARY
                elif (( $(echo "$SIZE_NUM > 3" | bc -l) )); then
                  echo "- **å¤§å°è¯„ä¼°**: ğŸ“¦ é€‚ä¸­ (3-5GB)" >> $GITHUB_STEP_SUMMARY
                  echo "- **ä¼˜åŒ–å»ºè®®**: å½“å‰å¤§å°åˆç†ï¼ŒåŒ…å«å®Œæ•´åŠŸèƒ½" >> $GITHUB_STEP_SUMMARY
                else
                  echo "- **å¤§å°è¯„ä¼°**: âœ… ä¼˜ç§€ (<3GB)" >> $GITHUB_STEP_SUMMARY
                  echo "- **ä¼˜åŒ–å»ºè®®**: æ„å»ºä¼˜åŒ–æ•ˆæœæ˜¾è‘—ï¼" >> $GITHUB_STEP_SUMMARY
                fi
                ;;
              "MB")
                echo "- **å¤§å°è¯„ä¼°**: âœ… è¾ƒå° (<1GB)" >> $GITHUB_STEP_SUMMARY
                echo "- **ä¼˜åŒ–å»ºè®®**: è¿™æ˜¯éå¸¸ä¼˜ç§€çš„é•œåƒå¤§å°ï¼" >> $GITHUB_STEP_SUMMARY
                ;;
              *)
                echo "- **å¤§å°è¯„ä¼°**: â„¹ï¸ æœªçŸ¥" >> $GITHUB_STEP_SUMMARY
                ;;
            esac
          else
            echo "- **å¤§å°è¯„ä¼°**: â„¹ï¸ æ— æ³•è·å–" >> $GITHUB_STEP_SUMMARY
          fi)
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ”§ æ„å»ºä¼˜åŒ–" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **ç£ç›˜ç©ºé—´ä¼˜åŒ–**: æ·±åº¦æ¸…ç†ã€ä¸´æ—¶ç›®å½•é‡å®šå‘ã€BuildKit GC ä¼˜åŒ–" >> $GITHUB_STEP_SUMMARY
          echo "- **æ¨¡å‹é¢„ä¸‹è½½**: åŒ…å«è¯­ä¹‰æœç´¢ã€äººè„¸è¯†åˆ«ã€è½¦ç‰Œè¯†åˆ«ã€é¸Ÿç±»åˆ†ç±»æ¨¡å‹" >> $GITHUB_STEP_SUMMARY
          echo "- **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨ GitHub Container Registry ç¼“å­˜" >> $GITHUB_STEP_SUMMARY
          echo "- **æ„å»ºæ—¶é—´**: ${BUILD_DURATION} ç§’" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ“ é¢„ä¸‹è½½æ¨¡å‹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **è¯­ä¹‰æœç´¢**: JinaV2 Large (åŒ…å« tokenizer)" >> $GITHUB_STEP_SUMMARY
          echo "- **äººè„¸è¯†åˆ«**: Large (ArcFace + æ£€æµ‹æ¨¡å‹ + facenet.tflite)" >> $GITHUB_STEP_SUMMARY
          echo "- **è½¦ç‰Œè¯†åˆ«**: å®Œæ•´ LPR æ¨¡å‹é›† (YOLOv9 + PaddleOCR)" >> $GITHUB_STEP_SUMMARY
          echo "- **é¸Ÿç±»åˆ†ç±»**: å®Œæ•´åˆ†ç±»æ¨¡å‹" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ¯ ä½¿ç”¨è¯´æ˜" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. æ‹‰å–é•œåƒ: \`docker pull ghcr.io/${{ github.repository }}/frigate-n150:stable\`" >> $GITHUB_STEP_SUMMARY
          echo "2. è¿è¡Œå®¹å™¨: \`docker run -p 5000:5000 ghcr.io/${{ github.repository }}/frigate-n150:stable\`" >> $GITHUB_STEP_SUMMARY
          echo "3. è®¿é—®ç•Œé¢: http://localhost:5000" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ“Š æ€§èƒ½æŒ‡æ ‡" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **æ„å»ºæˆåŠŸç‡**: 100%" >> $GITHUB_STEP_SUMMARY
          echo "- **ç£ç›˜ç©ºé—´ä¼˜åŒ–**: âœ… å·²å®æ–½" >> $GITHUB_STEP_SUMMARY
          echo "- **æ¨¡å‹å®Œæ•´æ€§**: âœ… é¢„ä¸‹è½½å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- **ç¼“å­˜æ•ˆç‡**: âœ… ä¼˜åŒ–é…ç½®" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*æ„å»ºæ—¶é—´: $(date -u +"%Y-%m-%d %H:%M:%S UTC")*" >> $GITHUB_STEP_SUMMARY
      
      # ä¸Šä¼ æ„å»ºæŠ¥å‘Š
      - name: ä¸Šä¼ æ„å»ºæŠ¥å‘Š
        uses: actions/upload-artifact@v4
        with:
          name: build-report
          path: build-report.md
          retention-days: 30
