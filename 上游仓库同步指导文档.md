# 上游仓库同步指导文档

## 项目背景

本项目是基于 [blakeblackshear/frigate](https://github.com/blakeblackshear/frigate) 的中文社区优化版本，需要定期与上游仓库同步以获取最新的稳定版本更新，同时保留我们自己的定制修改。

## 同步目标

1. 从上游仓库 https://github.com/blakeblackshear/frigate 获取 v0.16.0 稳定版代码
2. 将上游更新同步到本地的 upstream/v0.16.0 分支
3. 准备将上游更新合并到我们的工作分支中，保留定制内容
4. 创建合并预览，手动检查后再决定是否提交

## 实施步骤

### 1. 准备工作

```bash
# 确认远程仓库配置
git remote -v

# 预期输出应包含：
# origin    https://github.com/xxoolm/frigate.git (fetch/push)
# upstream  https://github.com/blakeblackshear/frigate.git (fetch/push)
```

### 2. 更新上游仓库数据

```bash
# 从上游仓库获取最新数据



# 查看上游仓库的 v0.16.0 标签
git tag -l "v0.16.0" --points-at upstream/v0.16.0
```

### 3. 更新本地 upstream/v0.16.0 分支

```bash
# 切换到 upstream/v0.16.0 分支
git checkout upstream/v0.16.0

# 重置分支到上游的 v0.16.0 标签（如果需要）
git reset --hard upstream/v0.16.0

# 推送更新到您的个人仓库（可选）
git push origin upstream/v0.16.0
```

### 4. 准备合并到工作分支

```bash
# 切换到您的工作分支（例如 v0.16.0-rc4-with-build-workflow）
git checkout v0.16.0-rc4-with-build-workflow

# 创建合并预览，不自动提交
git merge --no-commit --no-ff upstream/v0.16.0
```

### 5. 检查合并结果

```bash
# 查看合并状态
git status

# 查看冲突文件（如果有）
git diff --name-only --diff-filter=U

# 查看具体的冲突内容（如果有）
git diff
```

### 6. 决定是否提交合并

如果合并结果符合预期：

```bash
# 提交合并
git commit -m "合并上游 v0.16.0 更新"
```

如果合并结果不符合预期或需要取消合并：

```bash
# 取消合并
git merge --abort
```

## 注意事项

1. **备份重要工作**：在执行合并操作前，请确保重要的本地修改已经提交或备份

2. **冲突处理**：如果出现合并冲突，需要手动解决冲突后再提交

3. **测试验证**：合并完成后，建议进行充分的测试以确保功能正常

4. **保留定制内容**：确保在合并过程中不会丢失我们的自定义修改

## 常见问题处理

### 1. 如果上游分支不存在

```bash
# 基于上游标签创建分支
git checkout -b upstream/v0.16.0 upstream/v0.16.0
```

### 2. 如果需要强制更新上游分支

```bash
# 强制重置到上游标签
git checkout upstream/v0.16.0
git reset --hard upstream/v0.16.0
```

### 3. 如果合并后发现问题需要回退

```bash
# 查看提交历史
git log --oneline -10

# 回退到合并前的提交
git reset --hard <合并前的commit-hash>
```

## 验证同步结果

```bash
# 检查当前分支是否与上游标签一致
git log --oneline -5

# 比较与上游标签的差异
git diff upstream/v0.16.0..upstream/v0.16.0

# 检查我们自己的定制修改是否还在
git log --oneline --grep="自定义\|定制\|优化"  # 根据实际提交信息调整
```

## 后续操作建议

1. 定期执行此同步流程以保持与上游的同步
2. 在每次同步后进行充分测试
3. 及时推送更新到个人仓库以备份工作
4. 记录重要的合并操作和变更内容